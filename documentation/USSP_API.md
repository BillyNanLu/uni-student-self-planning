# 大学生自我规划平台接口文档-V1.0

## 1. 用户相关接口

<p style="color:red; font-weight:bold">个人信息修改、密码修改、头像修改权限为用户和管理员所有，用户相关接口中省略，具体请参照2.3-2.6</p>

### 1.1 注册

#### 1.1.1 基本信息

> 请求路径：/users/register
>
> 请求方式：POST
>
> 接口描述：该接口用于注册新用户



#### 1.1.2 请求参数

请求参数说明：

| 参数名称 | 说明   | 类型   | 是否必须 | 备注           |
| -------- | ------ | ------ | -------- | -------------- |
| username | 用户名 | string | 是       | 5~16位非空字符 |
| password | 密码   | string | 是       | 5~16位非空字符 |
| email    | 邮箱   | string | 是       | 格式校验       |
| phone    | 手机   | string | 是       | 格式校验       |
| name     | 姓名   | string | 否       | 姓名           |

⚠️ 说明：

- role 固定由系统设置，默认 0=学生。
- create_time、last_login 由后端生成，不允许前端传。

请求数据样例：

```json
{
  "username": "billy",
  "password": "abc123",
  "email": "billy@example.com",
  "phone": "13800001111",
  "name": "Billy"
}
```



#### 1.1.3 响应数据

响应数据类型：application/json

响应参数说明：

| 名称    | 类型   | 是否必须 | 默认值 | 备注                  | 其他信息 |
| ------- | ------ | -------- | ------ | --------------------- | -------- |
| code    | number | 必须     |        | 响应码, 0-成功,1-失败 |          |
| message | string | 非必须   |        | 提示信息              |          |
| data    | object | 非必须   |        | 返回的数据            |          |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "注册成功",
  "data": {
    "id": 101,
    "username": "billy",
    "email": "billy@example.com",
    "phone": "13800001111",
    "name": "Billy",
    "role": 0,
    "create_time": "2025-10-01T15:30:00Z",
    "last_login": null
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1001,
  "message": "用户名已存在",
  "data": null
}
```



### 1.2 登录

#### 1.2.1 基本信息

> 请求路径：/users/login
>
> 请求方式：POST
>
> 接口描述：该接口用于用户登录，登录成功后返回 token（JWT），需要前端在后续请求中携带。



#### 1.2.2 请求参数

请求参数说明：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**       |
| ------------ | -------- | -------- | ------------ | -------------- |
| username     | 用户名   | string   | 是           | 5~16位非空字符 |
| password     | 密码     | string   | 是           | 5~16位非空字符 |

请求数据样例：

```json
{
  "username": "billy",
  "password": "abc123"
}
```



#### 1.2.3 响应数据

响应数据类型：application/json

响应参数说明：

| **名称** | **类型** | **是否必须** | **默认值**                                  | **备注** | **其他信息** |
| -------- | -------- | ------------ | ------------------------------------------- | -------- | ------------ |
| code     | number   | 必须         | 响应码, 0-成功,1-失败                       |          |              |
| message  | string   | 非必须       | 提示信息                                    |          |              |
| data     | string   | 非必须       | 登录成功返回的 token（JWT），有效期 12 小时 |          |              |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "登录成功",
  "data": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

响应数据案例（失败）：

```json
{
  "code": 1002,
  "message": "用户名错误",
  "data": null
}
```

响应数据案例（失败）：

```json
{
  "code": 1003,
  "message": "密码错误",
  "data": null
}
```

⚠️ 说明：

- 登录成功后，后端会生成 **JWT token** 并返回，同时将 token 存储到 Redis（有效期 12 小时）。
- 前端在后续请求时，需要在请求头中携带：`Authorization: Bearer <token>`



### 1.3 获取用户详细信息

#### 1.3.1 基本信息

> 请求路径：/users/userInfo
>
> 请求方式：GET
>
> 接口描述：该接口用于获取当前已登录用户的详细信息



#### 1.3.2 请求参数

请求头参数说明：

| **参数名称**  | **说明** | **类型** | **是否必须** | **备注**                    |
| ------------- | -------- | -------- | ------------ | --------------------------- |
| Authorization | 认证令牌 | string   | 是           | 格式：Bearer + 空格 + token |

请求示例：

```http
GET /users/userInfo
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```



#### 1.3.3 响应数据

响应数据类型：application/json

响应参数说明：

| **名称**        | **类型** | **是否必须** | **默认值**              | **备注** |
| --------------- | -------- | ------------ | ----------------------- | -------- |
| code            | number   | 必须         | 响应码, 0-成功,1-失败   |          |
| message         | string   | 非必须       | 提示信息                |          |
| data            | object   | 非必须       | 用户信息对象            |          |
| \|- id          | number   | 必须         | 用户ID                  |          |
| \|- username    | string   | 必须         | 登录名                  |          |
| \|- name        | string   | 否           | 姓名                    |          |
| \|- email       | string   | 必须         | 邮箱                    |          |
| \|- phone       | string   | 必须         | 手机号                  |          |
| \|- role        | number   | 必须         | 角色（0=学生,1=管理员） |          |
| \|- avatar      | string   | 否           | 头像URL                 |          |
| \|- create_time | string   | 必须         | 注册时间                |          |
| \|-last_login   | string   | 否           | 最近登录时间            |          |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "id": 101,
    "username": "billy",
    "name": "Billy",
    "email": "billy@example.com",
    "phone": "13800001111",
    "role": 0,
    "avatar": "https://cdn.example.com/avatar/billy.png",
    "create_time": "2025-10-01T15:30:00Z",
    "last_login": "2025-10-03T09:20:00Z"
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1004,
  "message": "未登录或登录已过期",
  "data": null
}
```

⚠️ 说明：

- 此接口需要用户先登录，前端需在请求头中携带有效的 **JWT token**。
- 后端根据 token 解析用户 ID，再查询数据库并返回用户信息。





## 2. 管理员相关接口

### 2.1 管理员获取用户列表

#### **2.1.1 基本信息**

> 请求路径：GET /admin/users
>
> 请求方式：GET
>
> 接口描述：该接口用于管理员获取系统内所有用户的信息列表。
>
> 权限要求：仅管理员（role=1）可访问。



#### 2.1.2 请求参数

请求头参数说明：

| **数名称**    | **说明** | **类型** | **是否必须** | **备注**                    |
| ------------- | -------- | -------- | ------------ | --------------------------- |
| Authorization | 认证令牌 | string   | 是           | 格式：Bearer + 空格 + token |

查询参数说明（可选，用于分页和筛选）：

|         | **说明**   | **类型** | **是否必须** | **备注**                   |
| ------- | ---------- | -------- | ------------ | -------------------------- |
| page    | 页码       | int      | 否           | 默认 1                     |
| size    | 每页条数   | int      | 否           | 默认 10                    |
| keyword | 搜索关键字 | string   | 否           | 支持按用户名、姓名模糊搜索 |

请求示例：

```http
GET /admin/users?page=1&size=10&keyword=billy
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```



#### 2.1.3 响应数据

响应数据类型：application/json

响应参数说明：

| **名称**        | **类型** | **是否必须** | **备注**                |
| --------------- | -------- | ------------ | ----------------------- |
| code            | number   | 必须         | 响应码, 0-成功,1-失败   |
| message         | string   | 非必须       | 提示信息                |
| data            | object   | 非必须       | 返回分页数据            |
| \|- total       | number   | 必须         | 用户总数                |
| \|- records     | array    | 必须         | 用户列表数据            |
| \|- id          | number   | 必须         | 用户ID                  |
| \|- username    | string   | 必须         | 登录名                  |
| \|- name        | string   | 必须         | 姓名                    |
| \|-email        | string   | 必须         | 邮箱                    |
| \|- phone       | string   | 必须         | 手机号                  |
| \|- role        | number   | 必须         | 角色（0=学生,1=管理员） |
| \|- avatar      | string   | 否           | 头像URL                 |
| \|- create_time | string   | 必须         | 注册时间                |
| \|- last_login  | string   | 否           | 最近登录时间            |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "total": 2,
    "records": [
      {
        "id": 101,
        "username": "billy",
        "name": "Billy",
        "email": "billy@example.com",
        "phone": "13800001111",
        "role": 0,
        "avatar": "https://cdn.example.com/avatar/billy.png",
        "create_time": "2025-10-01T15:30:00Z",
        "last_login": "2025-10-03T09:20:00Z"
      },
      {
        "id": 1,
        "username": "admin",
        "name": "系统管理员",
        "email": "admin@example.com",
        "phone": "13900002222",
        "role": 1,
        "avatar": "https://cdn.example.com/avatar/admin.png",
        "create_time": "2025-09-20T09:00:00Z",
        "last_login": "2025-10-04T10:15:00Z"
      }
    ]
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1005,
  "message": "权限不足，仅管理员可访问",
  "data": null
}
```



### 2.2 删除用户

#### 2.2.1 基本信息

> 请求路径：/admin/users/{id}
>
> 请求方式：DELETE
>
> 接口描述：该接口用于管理员删除指定用户。
>
> 权限要求：仅管理员（role=1）可访问。



#### 2.2.2 请求参数

请求头参数说明：

| **参数名称**  | **说明** | **类型** | **是否必须** | **备注**                    |
| ------------- | -------- | -------- | ------------ | --------------------------- |
| Authorization | 认证令牌 | string   | 是           | 格式：Bearer + 空格 + token |

路径参数说明：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**     |
| ------------ | -------- | -------- | ------------ | ------------ |
| id           | 用户ID   | long     | 是           | 要删除的用户 |

请求示例：

```http
DELETE /admin/users/101
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```



#### 2.2.3 响应数据

响应数据类型：application/json

响应参数说明：

| **名称** | **类型** | **是否必须** | **备注**              |
| -------- | -------- | ------------ | --------------------- |
| code     | number   | 必须         | 响应码, 0-成功,1-失败 |
| message  | string   | 非必须       | 提示信息              |
| data     | object   | 否           | 返回数据              |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "用户删除成功",
  "data": null
}
```

响应数据案例（失败）：

```json
{
  "code": 1006,
  "message": "要删除的用户不存在",
  "data": null
}
```

```json
{
  "code": 1005,
  "message": "权限不足，仅管理员可访问",
  "data": null
}
```

⚠️ 说明：

- 此接口为 **逻辑删除** 或 **物理删除**，根据系统设计而定（建议逻辑删除，可保留审计记录）。
- 后端应在执行删除前校验：
  - 当前用户是否为管理员；
  - 目标用户是否存在；
  - 是否允许删除管理员账号（如不允许，应返回错误提示）。



### 2.3 用户/管理员修改信息

#### 2.3.1 基本信息

> 请求路径：
>
> - 普通用户更新自己信息：`/users/update`
>
> - 管理员更新任意用户信息：`/admin/users/{id}`
>
> 请求方式：PUT
>
> 接口描述：
>
> - 普通用户可更新自己的基本信息（`name`、`email`、`phone`）
> - 管理员可修改任意用户的信息（包括 `name`、`email`、`phone`、`role`）
>
> 此接口不能修改 `username`、`password`、`avatar`。



#### 2.3.2 请求参数

请求头参数说明：

| **参数名称**  | **说明**              | **是否必须** |
| ------------- | --------------------- | ------------ |
| Authorization | Bearer + 空格 + token | 是           |

路径参数说明：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**       |
| ------------ | -------- | -------- | ------------ | -------------- |
| id           | 用户ID   | long     | 是           | 要修改的用户ID |

请求体参数说明：

| **参数名** | **说明**                | **类型** | **是否必须** | **权限说明**    |
| ---------- | ----------------------- | -------- | ------------ | --------------- |
| name       | 姓名（昵称）            | string   | 否           | 用户/管理员均可 |
| email      | 邮箱                    | string   | 否           | 用户/管理员均可 |
| phone      | 手机号                  | string   | 否           | 用户/管理员均可 |
| role       | 角色（0=学生,1=管理员） | int      | 否           | 仅管理员可修改  |

> ⚠️ 说明：
>
> - `username`、`password`、`avatar` 字段不可通过此接口修改；
> - 若前端传入这些字段，后端应忽略并记录警告日志。

请求示例：

普通用户更新自己的信息：

```json
{
  "username": "billy",
  "name": "newbilly",
  "email": "newbilly@example.com",
  "phone": "13800002222"
}
```

**管理员更新用户信息**

```json
{
  "name": "Student A",
  "email": "studenta@example.com",
  "phone": "13800003333",
  "role": 0
}
```



#### 2.3.3 响应数据

响应数据类型：application/json

响应参数说明：

| **名称** | **类型** | **是否必须** | **备注**              |
| -------- | -------- | ------------ | --------------------- |
| code     | number   | 必须         | 响应码, 0-成功,1-失败 |
| message  | string   | 非必须       | 提示信息              |
| data     | object   | 否           | 修改后的用户信息      |

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "信息更新成功",
  "data": {
    "id": 101,
    "username": "billy",
    "name": "newbilly",
    "email": "newbilly@example.com",
    "phone": "13800002222",
    "role": 0
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1005,
  "message": "权限不足，无法修改其他用户信息",
  "data": null
}
```

失败响应示例（用户不存在）

```json
{
  "code": 1006,
  "message": "要修改的用户不存在",
  "data": null
}
```



### 2.4 用户/管理员修改密码

#### 2.4.1 基本信息

> 请求路径：
>
> - 普通用户修改自己密码：`/users/updatePwd`
> - 管理员修改任意用户密码：`/admin/users/{id}/updatePwd`
>
> 请求方式：PATCH
>
> 接口描述：
>
> - 普通用户：需验证旧密码后修改自己的登录密码。
> - 管理员：可直接重置任意用户的密码（无需旧密码验证）。



#### 2.4.2 请求参数

请求头参数说明：

| **参数名称**  | **说明** | **类型** | **是否必须** | **备注**                    |
| ------------- | -------- | -------- | ------------ | --------------------------- |
| Authorization | 认证令牌 | string   | 是           | 格式：Bearer + 空格 + token |

路径参数说明（仅管理员）：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**             |
| ------------ | -------- | -------- | ------------ | -------------------- |
| id           | 用户ID   | long     | 是           | 要修改密码的目标用户 |

请求体参数说明：

| **参数名称** | **说明**          | **类型** | **是否必须** | **备注**                   |
| ------------ | ----------------- | -------- | ------------ | -------------------------- |
| oldPassword  | 原密码            | string   | 是(用户必填) | 用户修改密码时需验证原密码 |
| newPassword  | 新密码（5~16 位） | string   | 是           | 管理员可直接重置新密码     |

请求数据样例：

普通用户修改自己密码：

```json
{
  "oldPassword": "123456",
  "newPassword": "newpass789"
}
```

管理员重置用户密码：

```json
{
  "newPassword": "reset8888"
}
```



#### 2.4.3 响应数据

响应数据类型：application/json

| **字段** | **类型** | **说明**           |
| -------- | -------- | ------------------ |
| code     | number   | 响应码，0 表示成功 |
| message  | string   | 提示信息           |
| data     | object   | 可为空             |

响应数据案例（成功）：

普通用户修改成功：

```json
{
  "code": 0,
  "message": "密码修改成功，请重新登录",
  "data": null
}
```

管理员重置密码成功：

```
{
  "code": 0,
  "message": "密码重置成功",
  "data": {
    "id": 102,
    "username": "lucy",
    "email": "lucy@example.com",
    "phone": "13800003333",
    "role": 0
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1007,
  "message": "原密码错误",
  "data": null
}
```

管理员尝试修改其他管理员密码（无权限）：

```json
{
  "code": 1008,
  "message": "权限不足，无法修改管理员密码",
  "data": null
}
```



### 2.4 修改头像

#### 2.4.1 基本信息

> 请求路径： /users/{id}/avatar
>
> 请求方式：PUT
>
> 接口描述：用户可更新自己的头像；管理员可修改任意用户头像。



#### 2.4.2 请求参数

请求头参数说明：

| **参数名称**  | **说明** | **类型** | **是否必须** | **备注**                    |
| ------------- | -------- | -------- | ------------ | --------------------------- |
| Authorization | 认证令牌 | string   | 是           | 格式：Bearer + 空格 + token |
| Content-Type  | 内容类型 | string   | 是           | multipart/form-data         |

路径参数说明：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**           |
| ------------ | -------- | -------- | ------------ | ------------------ |
| id           | 用户ID   | long     | 是           | 要修改头像的用户ID |

表单参数说明：

| **参数名称** | **说明** | **类型** | **是否必须** | **备注**           |
| ------------ | -------- | -------- | ------------ | ------------------ |
| file         | 头像文件 | file     | 是           | 支持 jpg、png 格式 |

请求数据样例（form-data）：`file: avatar.png`



#### 2.4.3 响应数据

响应数据类型：application/json

响应数据案例（成功）：

```json
{
  "code": 0,
  "message": "头像更新成功",
  "data": {
    "avatar": "https://cdn.example.com/avatar/billy_new.png"
  }
}
```

响应数据案例（失败）：

```json
{
  "code": 1005,
  "message": "权限不足，无法修改他人头像",
  "data": null
}
```

⚠️ 说明：

- 普通用户只能修改自己的头像；管理员可修改任意用户的头像。
- 后端可使用云存储服务（如七牛云、阿里OSS）上传文件并返回头像URL。
